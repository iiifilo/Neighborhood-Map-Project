function ViewModel(){var e=this,o=[];e.allLocations=ko.observableArray([]);var n=initializeMap();n&&(e.map=ko.observable(n),e.geocoder=ko.observable(initializeGeo(e.map())),e.clickHandler=function(n){moveMap(n,e.map(),o)},e.submitHandler=function(){updateLocation(e.map(),e.geocoder(),e.allLocations,o)},e.submitHandler())}function initializeMap(){geocoder=new google.maps.Geocoder;var e={center:{lat:q.lat,lng:q.lng},zoom:12,mapTypeId:google.maps.MapTypeId.ROADMAP};return new google.maps.Map(document.getElementById("map-canvas"),e)}function initializeGeo(e){function o(o){t=o===!0?a:a,e.setCenter(t)}var n,t,a=new google.maps.LatLng(q.lat,q.lng);return navigator.geolocation?(n=!0,navigator.geolocation.getCurrentPosition(function(o){t=new google.maps.LatLng(o.coords.latitude,o.coords.longitude),e.setCenter(t),q.lat=t.latitude,q.lng=t.longitude},function(){o(n)})):(n=!1,o(n)),geocoder}function fetchFoursquare(e,o,n){o([]);var t="https://api.foursquare.com/v2/venues/search?client_id=NEVWWB4QNWYIBNRSMMAMPSED3BZTNS3CSTSCHD1LLRR01A2U&client_secret=DZZOB2RCPHICI3YUWZDVW2BPCY3B5AXJMOLPEDY4WZPAPPAL&ll="+q.lat+","+q.lng+"&query="+q.food+"&v=20140806&m=foursquare",a=[];$.getJSON(t,function(t){t.response.venues.forEach(function(e){o.push(e),a.push({lat:e.location.lat,lng:e.location.lng,name:e.name,loc:e.location.address+" "+e.location.city})}),setMarkers(a,e,n)})}function setMarkers(e,o,n){e.forEach(function(e){var t=new google.maps.LatLng(e.lat,e.lng),a=new google.maps.Marker({position:t,map:o,animation:google.maps.Animation.DROP,content:e.name+"<br>"+e.loc});n.push(a);var i=new google.maps.InfoWindow;google.maps.event.addListener(a,"click",function(){i.open(o,this),i.setContent(this.content)})})}function updateLocation(e,o,n,t){var a=document.getElementById("address").value;""===a?fetchFoursquare(e,n,t):o.geocode({address:a},function(o,a){a==google.maps.GeocoderStatus.OK&&(e.setCenter(o[0].geometry.location),q.lat=o[0].geometry.location.k,q.lng=o[0].geometry.location.D,q.food=document.getElementById("food").value,clearMarkers(t),fetchFoursquare(e,n,t))})}function clearMarkers(e){for(var o=0;o<e.length;o++)e[o].setMap(null);e=[]}function moveMap(e,o,n){o.setCenter(new google.maps.LatLng(e.location.lat,e.location.lng)),o.setZoom(14);for(var t=0;t<n.length;t++){var a=n[t].content.split("<br>");e.name===a[0]&&toggleBounce(n[t])}}function toggleBounce(e){null!==e.getAnimation()?e.setAnimation(null):(e.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){e.setAnimation(null)},1400))}var q={lat:33.774828,lng:-84.296312,food:"wine"};document.addEventListener("DOMContentLoaded",ko.applyBindings(new ViewModel));